
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/icr_svg_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Friday Live Coding Script: Good-Practices with Conda and Docker - Research Software Good Practice</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#friday-live-coding-script-good-practices-with-conda-and-docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Research Software Good Practice" class="md-header__button md-logo" aria-label="Research Software Good Practice" data-md-component="logo">
      
  <img src="../../../assets/icr_svg_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Research Software Good Practice
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Friday Live Coding Script: Good-Practices with Conda and Docker
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Research Software Good Practice" class="md-nav__button md-logo" aria-label="Research Software Good Practice" data-md-component="logo">
      
  <img src="../../../assets/icr_svg_logo.svg" alt="logo">

    </a>
    Research Software Good Practice
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Webinar Series
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Webinar Series
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Good-practice
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Good-practice
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monday/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monday
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tuesday/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tuesday
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wednesday/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Wednesday
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../thursday/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thursday
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../friday/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Friday
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Vibe-coding
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Vibe-coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../vibe/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Admin
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Admin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Instructors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Instructors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Good-practice
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#friday-session-timings-instructor-guide-revised" class="md-nav__link">
    <span class="md-ellipsis">
      Friday Session Timings (Instructor Guide) — Revised
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-opening-welcome-why-use-conda-and-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Part 1: Opening, Welcome &amp; Why Use Conda and Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-creating-and-using-conda-environments-python-r" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Creating and Using Conda Environments (Python &amp; R)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Creating and Using Conda Environments (Python &amp; R)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Python Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-environment" class="md-nav__link">
    <span class="md-ellipsis">
      R Environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-introduction-to-docker-writing-a-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Part 3: Introduction to Docker &amp; Writing a Dockerfile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: Introduction to Docker &amp; Writing a Dockerfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-dockerfile-dockerdockerfilepython" class="md-nav__link">
    <span class="md-ellipsis">
      Python Dockerfile (docker/Dockerfile.python)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-dockerfile-dockerdockerfilerscript" class="md-nav__link">
    <span class="md-ellipsis">
      R Dockerfile (docker/Dockerfile.rscript)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-building-and-running-python-r-scripts-in-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Part 4: Building and Running Python &amp; R Scripts in Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 4: Building and Running Python &amp; R Scripts in Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    <span class="md-ellipsis">
      Python
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r" class="md-nav__link">
    <span class="md-ellipsis">
      R
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conda-dockerfile-dockerdockerfileconda" class="md-nav__link">
    <span class="md-ellipsis">
      Conda Dockerfile (docker/Dockerfile.conda)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-wrap-up-best-practices-homework" class="md-nav__link">
    <span class="md-ellipsis">
      Part 5: Wrap-up, Best Practices &amp; Homework
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-building-a-singularity-image-from-a-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Building a Singularity Image from a Dockerfile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Building a Singularity Image from a Dockerfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-install-singularity-if-needed-on-your-local-machine" class="md-nav__link">
    <span class="md-ellipsis">
      1. Install Singularity (if needed, on your local machine)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-build-the-sif-file-from-your-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      2. Build the SIF file from your Dockerfile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-transferring-the-sif-file-to-the-hpc" class="md-nav__link">
    <span class="md-ellipsis">
      Part 3: Transferring the SIF File to the HPC
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-running-python-r-scripts-in-singularity-on-alma" class="md-nav__link">
    <span class="md-ellipsis">
      Part 4: Running Python &amp; R Scripts in Singularity on Alma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-wrap-up-best-practices-homework_1" class="md-nav__link">
    <span class="md-ellipsis">
      Part 5: Wrap-up, Best Practices &amp; Homework
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-cheat-sheet-singularity-on-hpc" class="md-nav__link">
    <span class="md-ellipsis">
      Session Cheat Sheet: Singularity on HPC
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="friday-live-coding-script-good-practices-with-conda-and-docker">Friday Live Coding Script: Good-Practices with Conda and Docker</h1>
<p><a href="../overview/">instructor home</a></p>
<h2 id="friday-session-timings-instructor-guide-revised">Friday Session Timings (Instructor Guide) — Revised</h2>
<table>
<thead>
<tr>
<th>Part</th>
<th>Section(s) Covered</th>
<th style="text-align: center;">Suggested Time</th>
<th style="text-align: center;">Running Time</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Opening, Welcome &amp; Why Use Conda and Docker</td>
<td style="text-align: center;">10 min</td>
<td style="text-align: center;">10</td>
</tr>
<tr>
<td>2</td>
<td>Creating and Using Conda Environments (Python &amp; R)</td>
<td style="text-align: center;">15 min</td>
<td style="text-align: center;">25</td>
</tr>
<tr>
<td>3</td>
<td>Introduction to Docker &amp; Writing a Dockerfile</td>
<td style="text-align: center;">10 min</td>
<td style="text-align: center;">35</td>
</tr>
<tr>
<td>4</td>
<td>Building and Running Python &amp; R Scripts in Docker</td>
<td style="text-align: center;">20 min</td>
<td style="text-align: center;">55</td>
</tr>
<tr>
<td>5</td>
<td>Wrap-up, Best Practices &amp; Homework</td>
<td style="text-align: center;">5 min</td>
<td style="text-align: center;">60</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="part-1-opening-welcome-why-use-conda-and-docker">Part 1: Opening, Welcome &amp; Why Use Conda and Docker</h2>
<blockquote>
<p>Welcome to our final session! Today, we’ll learn how to use Conda and Docker to make our research environments reproducible and portable. This is essential for sharing your work and ensuring others (and future you!) can run your code.</p>
</blockquote>
<ul>
<li><strong>Conda</strong> helps you manage packages and environments for Python, R, and more.</li>
<li><strong>Docker</strong> lets you package your code and environment into a container that runs anywhere.</li>
</ul>
<hr />
<h2 id="part-2-creating-and-using-conda-environments-python-r">Part 2: Creating and Using Conda Environments (Python &amp; R)</h2>
<blockquote>
<p>Let’s start by creating Conda environments for both Python and R, matching the packages we’ve used this week.</p>
</blockquote>
<h3 id="python-environment">Python Environment</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a new conda environment for Python</span>
conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>good-python<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.11<span class="w"> </span>pandas<span class="w"> </span>matplotlib<span class="w"> </span>pytest<span class="w"> </span>-y
conda<span class="w"> </span>activate<span class="w"> </span>good-python

<span class="c1"># Check installed packages</span>
conda<span class="w"> </span>list

<span class="c1"># Run your Python script</span>
python<span class="w"> </span>src/python/analysis.py
</code></pre></div>
<h3 id="r-environment">R Environment</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a new conda environment for R</span>
conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>good-r<span class="w"> </span>r-base<span class="o">=</span><span class="m">4</span>.3<span class="w"> </span>r-tidyverse<span class="w"> </span>r-ggplot2<span class="w"> </span>r-testthat<span class="w"> </span>-y
conda<span class="w"> </span>activate<span class="w"> </span>good-r

<span class="c1"># Start R and run your script</span>
Rscript<span class="w"> </span>src/R/analysis.R
</code></pre></div>
<blockquote>
<p><strong>Tip:</strong> You can export your environment for sharing:
<div class="highlight"><pre><span></span><code>conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>&gt;<span class="w"> </span>environment.yml
conda<span class="w"> </span>env<span class="w"> </span><span class="nb">export</span><span class="w"> </span>--no-build<span class="w"> </span>&gt;<span class="w"> </span>environment-no.yml
</code></pre></div></p>
</blockquote>
<hr />
<h2 id="part-3-introduction-to-docker-writing-a-dockerfile">Part 3: Introduction to Docker &amp; Writing a Dockerfile</h2>
<blockquote>
<p>Docker lets you create a container with everything your code needs. Let’s write a simple Dockerfile for both Python and R.</p>
</blockquote>
<h3 id="python-dockerfile-dockerdockerfilepython">Python Dockerfile (<code>docker/Dockerfile.python</code>)</h3>
<div class="highlight"><pre><span></span><code><span class="c"># ---------- Python dockerfile --------------------------------</span>
<span class="c"># BUILD IT:     docker build -f docker/Dockerfile.python -t good-python .</span>
<span class="c"># CHECK IT:     docker run -it good-python /bin/bash</span>
<span class="c"># RUN IT:       docker run -v ./data:/app/data -v ./results:/app/results good-python</span>
<span class="c"># -------------------------------------------------------------</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.13-slim</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>matplotlib<span class="w"> </span>pytest
<span class="k">COPY</span><span class="w"> </span>src/python/analysis.py<span class="w"> </span>./analysis.py
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;analysis.py&quot;</span><span class="p">]</span>
</code></pre></div>
<h3 id="r-dockerfile-dockerdockerfilerscript">R Dockerfile (<code>docker/Dockerfile.rscript</code>)</h3>
<div class="highlight"><pre><span></span><code><span class="c"># filepath: Dockerfile.rscript</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">rocker/r-base:4.3.1</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="k">COPY</span><span class="w"> </span>src/R/analysis.R<span class="w"> </span>./analysis.R
<span class="k">COPY</span><span class="w"> </span>data/raw<span class="w"> </span>./data/raw

<span class="k">RUN</span><span class="w"> </span>R<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;install.packages(c(&#39;tidyverse&#39;, &#39;ggplot2&#39;, &#39;testthat&#39;), repos=&#39;https://cloud.r-project.org&#39;)&quot;</span>

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Rscript&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;analysis.R&quot;</span><span class="p">]</span>
</code></pre></div>
<hr />
<h2 id="part-4-building-and-running-python-r-scripts-in-docker">Part 4: Building and Running Python &amp; R Scripts in Docker</h2>
<blockquote>
<p>Let’s build and run our containers!</p>
</blockquote>
<h3 id="python">Python</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Build the Python Docker image</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>docker/Dockerfile.python<span class="w"> </span>-t<span class="w"> </span>good-python<span class="w"> </span>.
<span class="c1"># Look inside the docker image and navigate with bash</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>good-python<span class="w"> </span>/bin/bash
<span class="c1"># Run the Python container</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/data:/app/data<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/results:/app/results<span class="w"> </span>good-python
</code></pre></div>
<h3 id="r">R</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Build the R Docker image</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>docker/Dockerfile.r<span class="w"> </span>-t<span class="w"> </span>good-r<span class="w"> </span>.

<span class="c1"># Run the R container</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/data:/app/data<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/results:/app/results<span class="w"> </span>good-r
</code></pre></div>
<blockquote>
<p><strong>Tip:</strong> The <code>-v</code> flag mounts your local data and results folders into the container, so outputs are saved outside the container.</p>
</blockquote>
<hr />
<h3 id="conda-dockerfile-dockerdockerfileconda">Conda Dockerfile (<code>docker/Dockerfile.conda</code>)</h3>
<div class="highlight"><pre><span></span><code><span class="c"># filepath: Dockerfile.conda</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">continuumio/miniconda3:latest</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>

<span class="c"># Copy your environment file and scripts</span>
<span class="k">COPY</span><span class="w"> </span>environment.yml<span class="w"> </span>.
<span class="k">COPY</span><span class="w"> </span>src/python/analysis.py<span class="w"> </span>./analysis.py
<span class="k">COPY</span><span class="w"> </span>src/R/analysis.R<span class="w"> </span>./analysis.R
<span class="k">COPY</span><span class="w"> </span>data/raw<span class="w"> </span>./data/raw

<span class="c"># Create the conda environment</span>
<span class="k">RUN</span><span class="w"> </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>environment.yml

<span class="c"># Ensure conda environment is activated by default</span>
<span class="k">SHELL</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;conda&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;good-env&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/bin/bash&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">]</span>

<span class="c"># Set entrypoint to run either script (pass as argument)</span>
<span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;conda&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;good-env&quot;</span><span class="p">]</span>

<span class="c"># Default command (can be overridden)</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;analysis.py&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Build the Conda Docker image</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>docker/Dockerfile.conda<span class="w"> </span>-t<span class="w"> </span>good-conda<span class="w"> </span>.
<span class="c1"># Look inside the docker image and navigate with bash</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>good-python<span class="w"> </span>/bin/bash
<span class="c1"># Run the python script</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/data:/app/data<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/results:/app/results<span class="w"> </span>good-conda<span class="w"> </span>python<span class="w"> </span>analysis.py
<span class="c1"># Run the R script</span>
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/data:/app/data<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/results:/app/results<span class="w"> </span>good-conda<span class="w"> </span>Rscript<span class="w"> </span>analysis.R
</code></pre></div>
<h2 id="part-5-wrap-up-best-practices-homework">Part 5: Wrap-up, Best Practices &amp; Homework</h2>
<ul>
<li>
<p><strong>Best Practices:</strong></p>
<ul>
<li>Always use environment files (<code>environment.yml</code>, <code>Dockerfile</code>) for reproducibility.</li>
<li>Document your dependencies and how to run your code.</li>
<li>Use containers for sharing and deploying your research.</li>
</ul>
</li>
<li>
<p><strong>Homework:</strong></p>
<ul>
<li>Try building and running your own Docker container for a different script or project.</li>
<li>Share your <code>environment.yml</code> or <code>Dockerfile</code> with a collaborator and see if they can reproduce your results.</li>
</ul>
</li>
</ul>
<h2 id="part-2-building-a-singularity-image-from-a-dockerfile">Part 2: Building a Singularity Image from a Dockerfile</h2>
<blockquote>
<p>Let’s convert our Docker image to a Singularity image (<code>.sif</code> file).</p>
</blockquote>
<h3 id="1-install-singularity-if-needed-on-your-local-machine">1. Install Singularity (if needed, on your local machine)</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># On Ubuntu (if you have sudo)</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>singularity-container
<span class="c1"># Or use Apptainer (new name)</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>apptainer
</code></pre></div>
<h3 id="2-build-the-sif-file-from-your-dockerfile">2. Build the SIF file from your Dockerfile</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Build the Docker image first (if not already done)</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.conda<span class="w"> </span>-t<span class="w"> </span>good-conda<span class="w"> </span>.

<span class="c1"># Convert the Docker image to a Singularity SIF file</span>
singularity<span class="w"> </span>build<span class="w"> </span>good-conda.sif<span class="w"> </span>docker-daemon://good-conda:latest
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> You may need root/admin privileges to build the SIF file.</p>
</blockquote>
<hr />
<h2 id="part-3-transferring-the-sif-file-to-the-hpc">Part 3: Transferring the SIF File to the HPC</h2>
<blockquote>
<p>Now, let’s transfer the <code>.sif</code> file to Alma using <code>scp</code> or <code>rsync</code>.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># From your local machine</span>
scp<span class="w"> </span>good-conda.sif<span class="w"> </span>&lt;username&gt;@alma.icr.ac.uk:/data/your_folder/
<span class="c1"># Or using rsync</span>
rsync<span class="w"> </span>-av<span class="w"> </span>good-conda.sif<span class="w"> </span>&lt;username&gt;@alma.icr.ac.uk:/data/your_folder/
</code></pre></div>
<blockquote>
<p>Log in to Alma and check the file is there:</p>
</blockquote>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>&lt;username&gt;@alma.icr.ac.uk
ls<span class="w"> </span>/data/your_folder/good-conda.sif
</code></pre></div>
<hr />
<h2 id="part-4-running-python-r-scripts-in-singularity-on-alma">Part 4: Running Python &amp; R Scripts in Singularity on Alma</h2>
<blockquote>
<p>Let’s run our code inside the container on the HPC.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># Load Singularity module if needed</span>
module<span class="w"> </span>load<span class="w"> </span>singularity

<span class="c1"># Run the Python script</span>
singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--bind<span class="w"> </span>/data/your_folder/data:/app/data,/data/your_folder/results:/app/results<span class="w"> </span>good-conda.sif<span class="w"> </span>python<span class="w"> </span>analysis.py

<span class="c1"># Run the R script</span>
singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--bind<span class="w"> </span>/data/your_folder/data:/app/data,/data/your_folder/results:/app/results<span class="w"> </span>good-conda.sif<span class="w"> </span>Rscript<span class="w"> </span>analysis.R
</code></pre></div>
<blockquote>
<p><strong>Tip:</strong> The <code>--bind</code> option mounts your data and results folders inside the container.</p>
<p><strong>For batch jobs:</strong><br />
Create a simple SLURM script (e.g., <code>run_container.slurm</code>):</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --job-name=run_container</span>
<span class="c1">#SBATCH --output=container_output.txt</span>
<span class="c1">#SBATCH --time=01:00:00</span>
<span class="c1">#SBATCH --cpus-per-task=2</span>
<span class="c1">#SBATCH --mem=4G</span>

module<span class="w"> </span>load<span class="w"> </span>singularity
singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--bind<span class="w"> </span>/data/your_folder/data:/app/data,/data/your_folder/results:/app/results<span class="w"> </span>good-conda.sif<span class="w"> </span>python<span class="w"> </span>analysis.py
</code></pre></div>
<p>Submit with:
<div class="highlight"><pre><span></span><code>sbatch<span class="w"> </span>run_container.slurm
</code></pre></div></p>
<hr />
<h2 id="part-5-wrap-up-best-practices-homework_1">Part 5: Wrap-up, Best Practices &amp; Homework</h2>
<ul>
<li>
<p><strong>Best Practices:</strong></p>
<ul>
<li>Use Singularity for reproducible, portable research on HPC.</li>
<li>Always test your container locally before transferring to HPC.</li>
<li>Document your workflow for others to follow.</li>
</ul>
</li>
<li>
<p><strong>Homework:</strong></p>
<ul>
<li>Try building and running a Singularity container for a different project.</li>
<li>Share your <code>.sif</code> file and workflow with a collaborator.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="session-cheat-sheet-singularity-on-hpc">Session Cheat Sheet: Singularity on HPC</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Build Docker image</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.conda<span class="w"> </span>-t<span class="w"> </span>good-conda<span class="w"> </span>.
singularity<span class="w"> </span>build<span class="w"> </span>good-conda.sif<span class="w"> </span>docker-daemon://good-conda:latest
<span class="c1">#or </span>
docker<span class="w"> </span>save<span class="w"> </span>good-conda:latest<span class="w"> </span>-o<span class="w"> </span>good-conda.tar
singularity<span class="w"> </span>build<span class="w"> </span>good-conda.sif<span class="w"> </span>docker-archive://good-conda.tar

<span class="c1"># Use files to transfer to scratch and copy data</span>
<span class="c1">## Run the Python script</span>
singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--bind<span class="w"> </span>data:/app/data,results:/app/results<span class="w"> </span>good-conda.sif<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;source /opt/conda/etc/profile.d/conda.sh &amp;&amp; conda run -n good-env python /app/analysis.py&quot;</span>

<span class="c1">## Run the R script</span>
singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>--bind<span class="w"> </span>data:/app/data,results:/app/results<span class="w"> </span>good-conda.sif<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;source /opt/conda/etc/profile.d/conda.sh &amp;&amp; conda run -n good-env Rscript /app/analysis.R&quot;</span>
</code></pre></div>
<hr />
<p><strong>Congratulations on completing the course!</strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>